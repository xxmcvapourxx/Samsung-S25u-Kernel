// This file is generated by cargo2android.py --run --device --tests --dependencies --global_defaults=crosvm_defaults --add_workspace.

prebuilt_etc {
    name: "qcrosvm.policy",
    sub_dir: "seccomp_policy",
    arch: {
        arm64: {
            src: "seccomp_policy/qcrosvm.policy",
        },
        arm: {
            src: "seccomp_policy/qcrosvm.policy",
        },
    },
    system_ext_specific: true,
}

rust_binary {
    name: "qcrosvm",
    defaults: ["crosvm_defaults"],
    host_supported: false,
    system_ext_specific: true,
    crate_name: "qcrosvm",
    srcs: ["src/main.rs"],
    enabled: false,

    target: {
        linux_glibc: {
            flags: [
                "-C panic=abort",
            ],
        },
        linux_glibc_x86_64: {
            enabled: false,
        },
        linux_bionic_arm64: {
            relative_install_path: "aarch64-linux-bionic",
        },
        darwin: {
            enabled: false,
        },
    },
    arch: {
        arm64: {
            rustlibs: ["libaarch64"],
        },
    },

    edition: "2018",
    features: [
        "default",
    ],

    flags: [
        "-C overflow-checks=y",
    ],
    ld_flags: [
        "-Wl,--rpath,\\$$ORIGIN",
        "-Wl,--rpath,\\$$ORIGIN/../../lib64",
    ],

    rustlibs: [
        "libbase_rust",
        "libdevices",
        "libdisk",
        "liblibc",
        "libvm_memory",
        "libsync_rust",
        "libandroid_logger",
        "liblog_rust",
        "libminijail_rust",
        "libsimplelog",
        "libhypervisor",
        "libthiserror",
    ],
}

rust_defaults {
    name: "qcrosvm_defaults",
    defaults: ["crosvm_defaults"],
    crate_name: "qcrosvm",
    srcs: ["src/main.rs"],
    test_suites: ["general-tests"],
    auto_gen_config: true,
    edition: "2018",
}

rust_test_host {
    name: "qcrosvm_host_test_src_main",
    defaults: ["qcrosvm_defaults"],
}

rust_test {
    name: "qcrosvm_device_test_src_main",
    defaults: ["qcrosvm_defaults"],
}
